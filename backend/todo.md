1. refactor repository not to use entity directly
2. transaction